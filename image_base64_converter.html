<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image to Base64 Encoder/Decoder</title>
    <link rel="icon" href="https://blogger.googleusercontent.com/img/a/AVvXsEgIFnXbCEgaASrlgiFnXz6MPaK-kyelPH7eTOt9s0-nWtY5YSMAIG5mN4k7dnxX6M-C0AmbO3U9jikPwhBdpp7G9848hK_1c7kXLbqxamlfCbhe_l-kEb8pe5V6mEH3fiIokyxkIyavBLAMlAzSApPTbcYA1r-P9YDwpu9GBIsL1SV4zGLvMwFulKOECQ4" type="image/x-icon">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding-bottom: 80px;
        }
        
        .main-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(10px);
            margin: 20px auto;
            max-width: 1200px;
            overflow: hidden;
        }
        
        .header-section {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .header-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none"><path d="M0,0 L100,0 L100,100 Z" fill="rgba(255,255,255,0.1)"/></svg>');
            background-size: cover;
            opacity: 0.3;
        }
        
        .drop-zone {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 40px 20px;
            text-align: center;
            background: linear-gradient(135deg, #f8f9ff 0%, #e8f4f8 100%);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .drop-zone:hover,
        .drop-zone.dragover {
            border-color: #4ecdc4;
            background: linear-gradient(135deg, #e8f4f8 0%, #f0f8ff 100%);
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(76, 205, 196, 0.3);
        }
        
        .drop-zone.processing {
            border-color: #feca57;
            background: linear-gradient(135deg, #fff8e1 0%, #fef7cd 100%);
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }
        
        .file-input {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
            z-index: 10;
        }
        
        .image-preview {
            max-width: 100%;
            max-height: 300px;
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            margin: 20px 0;
            transition: transform 0.3s ease;
        }
        
        .image-preview:hover {
            transform: scale(1.02);
        }
        
        .result-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            border: 2px solid #e3e8ff;
            transition: all 0.3s ease;
        }
        
        .result-card:hover {
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
            border-color: #667eea;
        }
        
        .base64-textarea {
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            resize: vertical;
            background: #f8f9ff;
            border: 2px solid #e3e8ff;
            border-radius: 10px;
            transition: all 0.3s ease;
            min-height: 120px;
        }
        
        .base64-textarea:focus {
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 15px rgba(102, 126, 234, 0.2);
        }
        
        .copy-btn, .download-btn, .clear-btn {
            border-radius: 25px;
            padding: 10px 25px;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            position: relative;
            overflow: hidden;
        }
        
        .copy-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }
        
        .copy-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
            color: white;
        }
        
        .copy-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .copy-btn:active::after {
            width: 300px;
            height: 300px;
        }
        
        .download-btn {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: white;
        }
        
        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(76, 205, 196, 0.4);
            color: white;
        }
        
        .clear-btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            color: white;
        }
        
        .clear-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.4);
            color: white;
        }
        
        .info-badge {
            background: linear-gradient(45deg, #feca57, #ff9ff3);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            display: inline-block;
            margin: 5px;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .decode-section {
            background: #f8f9ff;
            border-radius: 15px;
            border: 2px solid #e3e8ff;
            padding: 20px;
            margin-top: 20px;
        }
        
        .tab-button {
            background: transparent;
            border: 2px solid #667eea;
            color: #667eea;
            padding: 10px 25px;
            border-radius: 25px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 0 10px 20px 0;
            position: relative;
            overflow: hidden;
        }
        
        .tab-button::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 100%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            transition: width 0.3s ease;
            z-index: -1;
        }
        
        .tab-button.active,
        .tab-button:hover {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .tab-button.active::after {
            width: 100%;
        }
        
        .progress-bar {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            height: 4px;
            border-radius: 2px;
            margin: 20px 0;
            transition: width 0.3s ease;
        }
        
        .home-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            color: white;
            font-size: 1.2rem;
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.3);
            transition: all 0.3s ease;
            z-index: 1000;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .home-button:hover {
            transform: translateY(-3px) scale(1.1);
            box-shadow: 0 12px 25px rgba(255, 107, 107, 0.5);
            background: linear-gradient(45deg, #ff5252, #d32f2f);
        }
        
        .home-button:active {
            transform: translateY(-1px) scale(1.05);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            max-width: 300px;
            border-radius: 10px;
            animation: slideIn 0.3s ease;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        .usage-examples {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9ff;
            border-radius: 15px;
            border: 2px solid #e3e8ff;
        }
        
        .example-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            height: 100%;
        }
        
        .example-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }
        
        .example-card code {
            background: #f1f3f9;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 0.9rem;
            display: block;
            white-space: pre-wrap;
            word-break: break-all;
        }
        
        .stats-badge {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin: 5px;
            display: inline-block;
        }
        
        .keyboard-shortcut {
            background: #e8f4f8;
            padding: 5px 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 0.8rem;
            color: #667eea;
            border: 1px solid #d1e7f0;
        }
        
        @media (max-width: 768px) {
            .main-container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .header-section {
                padding: 20px;
            }
            
            .drop-zone {
                padding: 30px 15px;
                min-height: 150px;
            }
            
            .tab-button {
                margin: 0 5px 10px 0;
                padding: 8px 15px;
                font-size: 0.9rem;
            }
            
            .home-button {
                width: 45px;
                height: 45px;
                font-size: 1rem;
            }
            
            .usage-examples {
                padding: 15px;
            }
        }
        
        .loading-spinner {
            display: none;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Home Button -->
    <button class="home-button" onclick="window.location.href='index.html'" title="Back to Home">
        <i class="fas fa-home"></i>
    </button>

    <div class="container-fluid">
        <div class="main-container">
            <!-- Header -->
            <div class="header-section">
                <h1 class="mb-3">
                    <i class="fas fa-image me-3"></i>
                    Image ↔ Base64 Converter
                </h1>
                <p class="mb-0">Convert images to Base64 strings and vice versa with ease!</p>
            </div>
            
            <div class="p-4">
                <!-- Mode Selection -->
                <div class="text-center mb-4">
                    <button class="tab-button active" data-mode="encode" id="encodeTab">
                        <i class="fas fa-upload me-2"></i>Encode Image
                    </button>
                    <button class="tab-button" data-mode="decode" id="decodeTab">
                        <i class="fas fa-download me-2"></i>Decode Base64
                    </button>
                </div>
                
                <!-- Encode Section -->
                <div id="encodeSection">
                    <!-- Drop Zone -->
                    <div class="drop-zone" id="dropZone">
                        <input type="file" class="file-input" id="fileInput" accept="image/*">
                        <div id="dropZoneContent">
                            <i class="fas fa-cloud-upload-alt fa-4x text-primary mb-3"></i>
                            <h4 class="text-primary">Drop your image here</h4>
                            <p class="text-muted mb-3">or click to browse files</p>
                            <div>
                                <span class="info-badge">JPG</span>
                                <span class="info-badge">PNG</span>
                                <span class="info-badge">GIF</span>
                                <span class="info-badge">WebP</span>
                                <span class="info-badge">SVG</span>
                                <span class="info-badge">BMP</span>
                            </div>
                            <div class="loading-spinner" id="loadingSpinner"></div>
                        </div>
                    </div>
                    
                    <!-- Image Preview -->
                    <div id="imagePreview" class="text-center" style="display: none;">
                        <h5 class="mt-4 mb-3">
                            <i class="fas fa-eye me-2"></i>Image Preview
                        </h5>
                        <img id="previewImg" class="image-preview" alt="Preview">
                        <div id="imageInfo" class="mt-3"></div>
                    </div>
                    
                    <!-- Base64 Result -->
                    <div id="base64Result" class="mt-4" style="display: none;">
                        <div class="result-card p-4">
                            <h5 class="mb-3">
                                <i class="fas fa-code me-2"></i>Base64 String
                            </h5>
                            <div class="mb-3">
                                <textarea id="base64Output" class="form-control base64-textarea" rows="6" readonly 
                                         placeholder="Base64 string will appear here..."></textarea>
                            </div>
                            <div class="d-flex gap-2 flex-wrap">
                                <button class="copy-btn" id="copyBtn">
                                    <i class="fas fa-copy me-2"></i>Copy Base64
                                </button>
                                <button class="copy-btn" id="copyDataUriBtn">
                                    <i class="fas fa-link me-2"></i>Copy Data URI
                                </button>
                                <button class="copy-btn" id="copyCssBtn">
                                    <i class="fas fa-palette me-2"></i>Copy CSS
                                </button>
                                <button class="clear-btn" id="clearBtn">
                                    <i class="fas fa-trash me-2"></i>Clear
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Decode Section -->
                <div id="decodeSection" style="display: none;">
                    <div class="decode-section">
                        <h5 class="mb-3">
                            <i class="fas fa-paste me-2"></i>Paste Base64 String
                        </h5>
                        <textarea id="base64Input" class="form-control base64-textarea mb-3" rows="6" 
                                 placeholder="Paste your Base64 string here (with or without data URI prefix)..."></textarea>
                        <div class="text-center">
                            <button class="download-btn" id="decodeBtn">
                                <i class="fas fa-magic me-2"></i>Decode to Image
                            </button>
                        </div>
                    </div>
                    
                    <!-- Decoded Image -->
                    <div id="decodedResult" class="mt-4" style="display: none;">
                        <div class="result-card p-4">
                            <h5 class="mb-3">
                                <i class="fas fa-image me-2"></i>Decoded Image
                            </h5>
                            <div class="text-center">
                                <img id="decodedImg" class="image-preview" alt="Decoded Image">
                                <div id="decodedImageInfo" class="mt-3"></div>
                                <div class="mt-3">
                                    <button class="download-btn" id="downloadBtn">
                                        <i class="fas fa-download me-2"></i>Download Image
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Usage Examples -->
                <div class="usage-examples">
                    <h5 class="mb-3">
                        <i class="fas fa-lightbulb me-2"></i>Usage Examples
                    </h5>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <div class="example-card">
                                <h6 class="text-primary">
                                    <i class="fas fa-code me-2"></i>HTML Usage
                                </h6>
                                <code>&lt;img src="data:image/png;base64,<span class="stats-badge">BASE64_STRING</span>"&gt;</code>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="example-card">
                                <h6 class="text-success">
                                    <i class="fas fa-palette me-2"></i>CSS Usage
                                </h6>
                                <code>background-image: url(data:image/png;base64,<span class="stats-badge">BASE64_STRING</span>);</code>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="example-card">
                                <h6 class="text-info">
                                    <i class="fab fa-js me-2"></i>JavaScript Usage
                                </h6>
                                <code>const img = 'data:image/png;base64,<span class="stats-badge">BASE64_STRING</span>';</code>
                            </div>
                        </div>
                    </div>
                    <div class="text-center mt-3">
                        <small class="text-muted">
                            <i class="fas fa-keyboard me-1"></i>
                            Keyboard shortcut: <span class="keyboard-shortcut">Ctrl+V</span> to paste, <span class="keyboard-shortcut">Ctrl+C</span> to copy
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        class ImageBase64Converter {
            constructor() {
                this.currentMode = 'encode';
                this.currentBase64 = '';
                this.currentDataUri = '';
                this.decodedDataUri = '';
                this.fileSizeLimit = 10 * 1024 * 1024; // 10MB limit
                this.isProcessing = false;
                this.init();
            }
            
            init() {
                this.bindEvents();
                this.setupKeyboardShortcuts();
            }
            
            bindEvents() {
                // Mode switching
                document.getElementById('encodeTab').addEventListener('click', () => this.switchMode('encode'));
                document.getElementById('decodeTab').addEventListener('click', () => this.switchMode('decode'));
                
                // File handling - using a single click handler to prevent double triggering
                const dropZone = document.getElementById('dropZone');
                const fileInput = document.getElementById('fileInput');
                
                // Use a flag to prevent multiple clicks
                let clickInProgress = false;
                
                dropZone.addEventListener('click', (e) => {
                    if (!clickInProgress && !this.isProcessing) {
                        clickInProgress = true;
                        fileInput.click();
                        setTimeout(() => {
                            clickInProgress = false;
                        }, 100);
                    }
                });
                
                fileInput.addEventListener('change', (e) => {
                    if (!this.isProcessing) {
                        this.handleFileSelect(e);
                    }
                });
                
                // Drag and drop events
                dropZone.addEventListener('dragover', this.handleDragOver.bind(this));
                dropZone.addEventListener('dragleave', this.handleDragLeave.bind(this));
                dropZone.addEventListener('drop', this.handleDrop.bind(this));
                
                // Button events
                document.getElementById('copyBtn').addEventListener('click', () => this.copyToClipboard('base64'));
                document.getElementById('copyDataUriBtn').addEventListener('click', () => this.copyToClipboard('dataUri'));
                document.getElementById('copyCssBtn').addEventListener('click', () => this.copyToClipboard('css'));
                document.getElementById('clearBtn').addEventListener('click', this.clearResults.bind(this));
                document.getElementById('decodeBtn').addEventListener('click', this.decodeBase64.bind(this));
                document.getElementById('downloadBtn').addEventListener('click', this.downloadDecodedImage.bind(this));
            }
            
            setupKeyboardShortcuts() {
                document.addEventListener('keydown', (e) => {
                    // Ctrl+V for paste
                    if (e.ctrlKey && e.key === 'v' && this.currentMode === 'decode') {
                        const base64Input = document.getElementById('base64Input');
                        if (document.activeElement === base64Input) {
                            setTimeout(() => this.decodeBase64(), 100);
                        }
                    }
                    
                    // Ctrl+C for copy
                    if (e.ctrlKey && e.key === 'c' && this.currentMode === 'encode') {
                        const base64Output = document.getElementById('base64Output');
                        if (document.activeElement === base64Output) {
                            this.copyToClipboard('base64');
                        }
                    }
                });
            }
            
            switchMode(mode) {
                this.currentMode = mode;
                
                // Update tab buttons
                document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                document.getElementById(mode + 'Tab').classList.add('active');
                
                // Show/hide sections
                document.getElementById('encodeSection').style.display = mode === 'encode' ? 'block' : 'none';
                document.getElementById('decodeSection').style.display = mode === 'decode' ? 'block' : 'none';
                
                // Clear results when switching
                this.clearResults();
            }
            
            handleDragOver(e) {
                e.preventDefault();
                document.getElementById('dropZone').classList.add('dragover');
            }
            
            handleDragLeave(e) {
                e.preventDefault();
                document.getElementById('dropZone').classList.remove('dragover');
            }
            
            handleDrop(e) {
                e.preventDefault();
                document.getElementById('dropZone').classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0 && files[0].type.startsWith('image/')) {
                    this.processFile(files[0]);
                } else {
                    this.showNotification('Please drop a valid image file!', 'error');
                }
            }
            
            handleFileSelect(e) {
                const file = e.target.files[0];
                if (file && file.type.startsWith('image/')) {
                    if (file.size > this.fileSizeLimit) {
                        this.showNotification(`File size exceeds limit of ${this.fileSizeLimit / (1024 * 1024)}MB!`, 'error');
                        return;
                    }
                    this.processFile(file);
                } else {
                    this.showNotification('Please select a valid image file!', 'error');
                }
                
                // Clear the file input to allow selecting the same file again
                e.target.value = '';
            }
            
            processFile(file) {
                // Prevent multiple file processing
                if (this.isProcessing) {
                    this.showNotification('Please wait while processing the current file...', 'info');
                    return;
                }
                
                this.isProcessing = true;
                
                // Show processing state
                document.getElementById('dropZone').classList.add('processing');
                document.getElementById('loadingSpinner').style.display = 'block';
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    const base64String = e.target.result;
                    this.displayResults(file, base64String);
                    document.getElementById('dropZone').classList.remove('processing');
                    document.getElementById('loadingSpinner').style.display = 'none';
                    this.isProcessing = false;
                };
                reader.onerror = () => {
                    this.showNotification('Error reading file!', 'error');
                    document.getElementById('dropZone').classList.remove('processing');
                    document.getElementById('loadingSpinner').style.display = 'none';
                    this.isProcessing = false;
                };
                reader.readAsDataURL(file);
            }
            
            displayResults(file, base64String) {
                // Show image preview
                const previewImg = document.getElementById('previewImg');
                previewImg.src = base64String;
                document.getElementById('imagePreview').style.display = 'block';
                
                // Display image info
                const imageInfo = document.getElementById('imageInfo');
                const fileSizeKB = (file.size / 1024).toFixed(2);
                const base64SizeKB = ((base64String.length * 3) / 4 / 1024).toFixed(2);
                
                imageInfo.innerHTML = `
                    <div class="row text-center">
                        <div class="col-md-3 mb-2">
                            <strong>File Name:</strong><br>
                            <span class="text-muted">${file.name}</span>
                        </div>
                        <div class="col-md-3 mb-2">
                            <strong>File Size:</strong><br>
                            <span class="text-muted">${fileSizeKB} KB</span>
                        </div>
                        <div class="col-md-3 mb-2">
                            <strong>Type:</strong><br>
                            <span class="text-muted">${file.type}</span>
                        </div>
                        <div class="col-md-3 mb-2">
                            <strong>Base64 Size:</strong><br>
                            <span class="text-muted">${base64SizeKB} KB</span>
                        </div>
                    </div>
                `;
                
                // Show base64 result
                const base64Only = base64String.split(',')[1];
                document.getElementById('base64Output').value = base64Only;
                document.getElementById('base64Result').style.display = 'block';
                
                // Store for copying
                this.currentBase64 = base64Only;
                this.currentDataUri = base64String;
                this.currentMimeType = file.type;
                
                this.showNotification('Image converted successfully!', 'success');
            }
            
            copyToClipboard(type) {
                let textToCopy = '';
                let message = '';
                
                switch(type) {
                    case 'base64':
                        textToCopy = this.currentBase64;
                        message = 'Base64 string copied to clipboard!';
                        break;
                    case 'dataUri':
                        textToCopy = this.currentDataUri;
                        message = 'Data URI copied to clipboard!';
                        break;
                    case 'css':
                        textToCopy = `background-image: url(${this.currentDataUri});`;
                        message = 'CSS code copied to clipboard!';
                        break;
                }
                
                // Try modern clipboard API first
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(textToCopy).then(() => {
                        this.showNotification(message, 'success');
                    }).catch(() => {
                        this.fallbackCopyToClipboard(textToCopy);
                        this.showNotification(message, 'success');
                    });
                } else {
                    // Fallback for older browsers
                    this.fallbackCopyToClipboard(textToCopy);
                    this.showNotification(message, 'success');
                }
            }
            
            fallbackCopyToClipboard(text) {
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                textArea.setSelectionRange(0, 99999); // For mobile devices
                
                try {
                    const successful = document.execCommand('copy');
                    if (!successful) {
                        throw new Error('Copy command failed');
                    }
                } catch (err) {
                    console.error('Fallback copy failed:', err);
                    this.showNotification('Copy failed. Please select and copy manually.', 'error');
                }
                
                document.body.removeChild(textArea);
            }
            
            decodeBase64() {
                const base64Input = document.getElementById('base64Input').value.trim();
                
                if (!base64Input) {
                    this.showNotification('Please paste a Base64 string!', 'error');
                    return;
                }
                
                try {
                    let dataUri = base64Input;
                    
                    // If it's just base64 without data URI prefix, try to detect format
                    if (!base64Input.startsWith('data:')) {
                        // Try to detect format from the base64 string
                        const base64Header = base64Input.substring(0, 20);
                        let detectedType = 'image/png';
                        
                        if (base64Header.includes('iVBORw0KGgo')) {
                            detectedType = 'image/png';
                        } else if (base64Header.includes('/9j/')) {
                            detectedType = 'image/jpeg';
                        } else if (base64Header.includes('R0lGOD')) {
                            detectedType = 'image/gif';
                        } else if (base64Header.includes('UklGR')) {
                            detectedType = 'image/webp';
                        } else if (base64Header.includes('PHN2ZyB4')) {
                            detectedType = 'image/svg+xml';
                        }
                        
                        dataUri = `data:${detectedType};base64,${base64Input}`;
                    }
                    
                    // Create image to test if base64 is valid
                    const img = new Image();
                    img.onload = () => {
                        document.getElementById('decodedImg').src = dataUri;
                        
                        // Show decoded image info
                        const decodedImageInfo = document.getElementById('decodedImageInfo');
                        const base64Size = ((base64Input.length * 3) / 4 / 1024).toFixed(2);
                        
                        decodedImageInfo.innerHTML = `
                            <div class="row text-center">
                                <div class="col-md-4 mb-2">
                                    <strong>Dimensions:</strong><br>
                                    <span class="text-muted">${img.naturalWidth} × ${img.naturalHeight}px</span>
                                </div>
                                <div class="col-md-4 mb-2">
                                    <strong>Estimated Size:</strong><br>
                                    <span class="text-muted">${base64Size} KB</span>
                                </div>
                                <div class="col-md-4 mb-2">
                                    <strong>Format:</strong><br>
                                    <span class="text-muted">${this.extractMimeType(dataUri)}</span>
                                </div>
                            </div>
                        `;
                        
                        document.getElementById('decodedResult').style.display = 'block';
                        this.decodedDataUri = dataUri;
                        this.showNotification('Base64 decoded successfully!', 'success');
                    };
                    
                    img.onerror = () => {
                        this.showNotification('Invalid Base64 string or unsupported image format!', 'error');
                    };
                    
                    img.src = dataUri;
                    
                } catch (error) {
                    this.showNotification('Error decoding Base64 string!', 'error');
                    console.error('Decode error:', error);
                }
            }
            
            downloadDecodedImage() {
                if (!this.decodedDataUri) return;
                
                // Create download link
                const link = document.createElement('a');
                const mimeType = this.extractMimeType(this.decodedDataUri);
                const extension = mimeType.split('/')[1] || 'png';
                link.download = `decoded_image_${Date.now()}.${extension}`;
                link.href = this.decodedDataUri;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                this.showNotification('Image downloaded successfully!', 'success');
            }
            
            extractMimeType(dataUri) {
                const match = dataUri.match(/data:([^;]+)/);
                return match ? match[1] : 'Unknown';
            }
            
            clearResults() {
                // Hide all result sections
                document.getElementById('imagePreview').style.display = 'none';
                document.getElementById('base64Result').style.display = 'none';
                document.getElementById('decodedResult').style.display = 'none';
                
                // Clear inputs
                document.getElementById('fileInput').value = '';
                document.getElementById('base64Input').value = '';
                document.getElementById('base64Output').value = '';
                
                // Reset drop zone
                document.getElementById('dropZone').classList.remove('processing', 'dragover');
                document.getElementById('loadingSpinner').style.display = 'none';
                
                // Clear stored data
                this.currentBase64 = '';
                this.currentDataUri = '';
                this.decodedDataUri = '';
                
                this.showNotification('Results cleared!', 'info');
            }
            
            showNotification(message, type) {
                // Remove existing notifications
                const existingNotifications = document.querySelectorAll('.notification');
                existingNotifications.forEach(notification => {
                    notification.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                });
                
                // Create notification element
                const notification = document.createElement('div');
                notification.className = `notification alert alert-${type === 'success' ? 'success' : type === 'error' ? 'danger' : 'info'}`;
                notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; max-width: 300px; border-radius: 10px;';
                notification.innerHTML = `
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'} me-2"></i>
                    ${message}
                `;
                
                document.body.appendChild(notification);
                
                // Auto remove after 3 seconds
                setTimeout(() => {
                    notification.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }, 3000);
            }
        }
        
        // Initialize the converter when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            new ImageBase64Converter();
        });
    </script>
</body>
</html>
