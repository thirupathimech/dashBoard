<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern Loan Calculator</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Animate.css -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <!-- jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <!-- DataTables -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.21/css/dataTables.bootstrap5.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.21/js/jquery.dataTables.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.21/js/dataTables.bootstrap5.min.js"></script>
    <!-- AOS Animation -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>

    <style>
        :root {
            --primary-color: #000000;
            --secondary-color: #1a1a1a;
            --accent-color: #333333;
            --light-color: #ffffff;
            --gray-color: #666666;
            --border-color: rgba(255, 255, 255, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 50%, #2d2d2d 100%);
            color: var(--light-color);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(255, 255, 255, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 255, 255, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        .home-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1050;
            background: linear-gradient(45deg, var(--accent-color), var(--gray-color));
            border: 2px solid var(--border-color);
            backdrop-filter: blur(10px);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .home-btn:hover {
            background: linear-gradient(45deg, var(--gray-color), #888);
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 10px 30px rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(15px);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }

        .glass-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.6s;
        }

        .glass-card:hover::before {
            left: 100%;
        }

        .glass-card:hover {
            transform: translateY(-5px);
            border-color: rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 40px rgba(255, 255, 255, 0.1);
        }

        .hero-section {
            text-align: center;
            padding: 4rem 0 2rem;
            position: relative;
        }

        .hero-title {
            font-size: 4rem;
            font-weight: 900;
            background: linear-gradient(45deg, #ffffff, #cccccc, #ffffff);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 3s ease-in-out infinite;
            text-shadow: 0 0 30px rgba(255, 255, 255, 0.3);
            margin-bottom: 1rem;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .hero-subtitle {
            font-size: 1.3rem;
            color: #cccccc;
            font-weight: 300;
            margin-bottom: 2rem;
        }

        .form-floating > label {
            color: rgba(255, 255, 255, 0.7);
        }

        .form-floating > .form-control {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid var(--border-color);
            color: var(--light-color);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .form-floating > .form-control:focus {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
            color: var(--light-color);
        }

        .btn-calculate {
            background: linear-gradient(45deg, var(--accent-color), var(--gray-color));
            border: none;
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: 15px;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }

        .btn-calculate::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s;
        }

        .btn-calculate:hover::before {
            left: 100%;
        }

        .btn-calculate:hover {
            background: linear-gradient(45deg, var(--gray-color), #888);
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 15px 35px rgba(255, 255, 255, 0.2);
        }

        .result-item {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--border-color);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .result-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(45deg, var(--light-color), var(--gray-color));
            transform: scaleY(0);
            transition: transform 0.3s ease;
        }

        .result-item:hover::before {
            transform: scaleY(1);
        }

        .result-item:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateX(10px);
        }

        .result-label {
            font-size: 0.9rem;
            color: #cccccc;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .result-value {
            font-size: 1.8rem;
            font-weight: 900;
            color: var(--light-color);
            margin-top: 0.5rem;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin: 2rem 0;
        }

        #loanChart {
            filter: drop-shadow(0 4px 8px rgba(255, 255, 255, 0.1));
        }

        .table-dark {
            --bs-table-bg: rgba(255, 255, 255, 0.05);
            --bs-table-striped-bg: rgba(255, 255, 255, 0.02);
            --bs-table-border-color: var(--border-color);
        }

        .dataTables_wrapper .dataTables_length,
        .dataTables_wrapper .dataTables_filter,
        .dataTables_wrapper .dataTables_info,
        .dataTables_wrapper .dataTables_paginate {
            color: var(--light-color);
        }

        .dataTables_wrapper .dataTables_filter input,
        .dataTables_wrapper .dataTables_length select {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            color: var(--light-color);
            border-radius: 8px;
            padding: 5px 10px;
        }

        .page-link {
            background-color: rgba(255, 255, 255, 0.05);
            border-color: var(--border-color);
            color: var(--light-color);
        }

        .page-link:hover {
            background-color: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
            color: var(--light-color);
        }

        .page-item.active .page-link {
            background-color: var(--gray-color);
            border-color: var(--gray-color);
        }

        .download-section {
            text-align: center;
            margin: 2rem 0;
        }

        .btn-download {
            background: linear-gradient(45deg, var(--accent-color), var(--gray-color));
            border: 1px solid var(--border-color);
            color: var(--light-color);
            margin: 0.5rem;
            padding: 10px 20px;
            border-radius: 10px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn-download::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn-download:hover::before {
            left: 100%;
        }

        .btn-download:hover {
            background: linear-gradient(45deg, var(--gray-color), #888);
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 255, 255, 0.15);
        }

        .loading-spinner {
            display: none;
            text-align: center;
            padding: 2rem;
        }

        .spinner-border {
            width: 3rem;
            height: 3rem;
            border-width: 0.3rem;
        }

        .bounce-in {
            animation: bounceIn 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes bounceIn {
            0% {
                transform: scale(0);
                opacity: 0;
            }
            60% {
                transform: scale(1.1);
                opacity: 1;
            }
            100% {
                transform: scale(1);
            }
        }

        .pulse-animation {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @media (max-width: 768px) {
            .hero-title {
                font-size: 2.5rem;
            }
            
            .hero-subtitle {
                font-size: 1.1rem;
            }
            
            .chart-container {
                height: 300px;
            }
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--secondary-color);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gray-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #888;
        }
    </style>
</head>
<body>
    <a href="index.html" class="btn btn-outline-light home-btn">
        <i class="fas fa-home me-2"></i>Home
    </a>
    
    <div class="container-fluid">
        <!-- Hero Section -->
        <div class="hero-section" data-aos="fade-up">
            <h1 class="hero-title">Loan Calculator</h1>
            <p class="hero-subtitle">Calculate your loan payments with interactive charts and detailed analysis</p>
        </div>

        <div class="container">
            <!-- Calculator Section -->
            <div class="row g-4 mb-5">
                <div class="col-lg-6" data-aos="fade-right" data-aos-delay="200">
                    <div class="glass-card p-4">
                        <h3 class="mb-4 text-center">
                            <i class="fas fa-calculator me-2"></i>Loan Details
                        </h3>
                        
                        <form id="loanForm">
                            <div class="form-floating mb-3">
                                <input type="number" class="form-control" id="loanAmount" placeholder="Enter loan amount" min="1000" required>
                                <label for="loanAmount"><i class="fas fa-rupee-sign me-2"></i>Loan Amount (₹)</label>
                            </div>
                            
                            <div class="form-floating mb-3">
                                <input type="number" class="form-control" id="interestRate" placeholder="Enter interest rate" step="0.01" min="0" required>
                                <label for="interestRate"><i class="fas fa-percent me-2"></i>Annual Interest Rate (%)</label>
                            </div>
                            
                            <div class="form-floating mb-4">
                                <input type="number" class="form-control" id="loanTerm" placeholder="Enter loan term" min="1" required>
                                <label for="loanTerm"><i class="fas fa-calendar-alt me-2"></i>Loan Term (years)</label>
                            </div>
                            
                            <button type="button" class="btn btn-calculate w-100" id="calculateBtn">
                                <i class="fas fa-cog me-2"></i>Calculate Loan
                            </button>
                        </form>
                    </div>
                </div>

                <div class="col-lg-6" data-aos="fade-left" data-aos-delay="400">
                    <div class="glass-card p-4">
                        <h3 class="mb-4 text-center">
                            <i class="fas fa-chart-line me-2"></i>Payment Summary
                        </h3>
                        
                        <div id="results">
                            <div class="result-item">
                                <div class="result-label">
                                    <i class="fas fa-money-bill-wave me-2"></i>Monthly Payment
                                </div>
                                <div class="result-value" id="monthlyPayment">₹0</div>
                            </div>
                            
                            <div class="result-item">
                                <div class="result-label">
                                    <i class="fas fa-coins me-2"></i>Total Payment
                                </div>
                                <div class="result-value" id="totalPayment">₹0</div>
                            </div>
                            
                            <div class="result-item">
                                <div class="result-label">
                                    <i class="fas fa-chart-pie me-2"></i>Total Interest
                                </div>
                                <div class="result-value" id="totalInterest">₹0</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Loading Spinner -->
            <div class="loading-spinner" id="loadingSpinner">
                <div class="spinner-border text-light" role="status">
                    <span class="visually-hidden">Calculating...</span>
                </div>
                <p class="mt-3">Generating detailed analysis...</p>
            </div>

            <!-- Chart Section -->
            <div class="row d-none" id="chartSection" data-aos="fade-up" data-aos-delay="600">
                <div class="col-12">
                    <div class="glass-card p-4">
                        <h3 class="text-center mb-4">
                            <i class="fas fa-bar-chart me-2"></i>Payment Analysis
                        </h3>
                        <div class="chart-container">
                            <canvas id="loanChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Table Section -->
            <div class="row d-none mt-4" id="tableSection" data-aos="fade-up" data-aos-delay="800">
                <div class="col-12">
                    <div class="glass-card p-4">
                        <h3 class="text-center mb-4">
                            <i class="fas fa-table me-2"></i>Complete Amortization Schedule
                        </h3>
                        
                        <div class="download-section">
                            <button class="btn btn-download" id="downloadCSV">
                                <i class="fas fa-file-csv me-2"></i>Download CSV
                            </button>
                            <button class="btn btn-download" id="downloadPDF">
                                <i class="fas fa-file-pdf me-2"></i>Download PDF
                            </button>
                            <button class="btn btn-download" id="printTable">
                                <i class="fas fa-print me-2"></i>Print Table
                            </button>
                        </div>
                        
                        <div class="table-responsive">
                            <table id="amortizationTable" class="table table-dark table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th><i class="fas fa-hashtag me-1"></i>Payment #</th>
                                        <th><i class="fas fa-money-bill me-1"></i>Payment Amount</th>
                                        <th><i class="fas fa-coins me-1"></i>Principal</th>
                                        <th><i class="fas fa-percent me-1"></i>Interest</th>
                                        <th><i class="fas fa-balance-scale me-1"></i>Remaining Balance</th>
                                    </tr>
                                </thead>
                                <tbody id="tableBody">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function() {
            // Initialize AOS animations
            AOS.init({
                duration: 1000,
                easing: 'ease-out-back',
                once: true
            });

            let loanData = [];
            let chart;
            let dataTable;

            // Form validation and calculation
            $('#calculateBtn').click(function() {
                if (validateForm()) {
                    calculateLoan();
                }
            });

            // Real-time input validation
            $('.form-control').on('input', function() {
                $(this).removeClass('is-invalid is-valid');
                if ($(this).val()) {
                    $(this).addClass('is-valid');
                }
            });

            function validateForm() {
                let isValid = true;
                const fields = ['loanAmount', 'interestRate', 'loanTerm'];
                
                fields.forEach(field => {
                    const element = $('#' + field);
                    const value = parseFloat(element.val());
                    
                    element.removeClass('is-invalid is-valid');
                    
                    if (!value || value <= 0) {
                        element.addClass('is-invalid');
                        isValid = false;
                    } else {
                        element.addClass('is-valid');
                    }
                });

                if (!isValid) {
                    // Shake animation for invalid form
                    $('#loanForm').addClass('animate__animated animate__shakeX');
                    setTimeout(() => {
                        $('#loanForm').removeClass('animate__animated animate__shakeX');
                    }, 1000);
                }

                return isValid;
            }

            function calculateLoan() {
                // Show loading spinner
                $('#loadingSpinner').fadeIn();
                
                // Hide previous results
                $('#chartSection, #tableSection').addClass('d-none');

                const loanAmount = parseFloat($('#loanAmount').val());
                const interestRate = parseFloat($('#interestRate').val());
                const loanTerm = parseFloat($('#loanTerm').val());

                const monthlyRate = interestRate / 100 / 12;
                const numPayments = loanTerm * 12;
                
                const monthlyPayment = loanAmount * (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) / 
                                       (Math.pow(1 + monthlyRate, numPayments) - 1);

                const totalPayment = monthlyPayment * numPayments;
                const totalInterest = totalPayment - loanAmount;

                // Simulate processing time for better UX
                setTimeout(() => {
                    // Hide loading spinner
                    $('#loadingSpinner').fadeOut();
                    
                    // Animate results update
                    animateCountUp('#monthlyPayment', 0, monthlyPayment, '₹');
                    animateCountUp('#totalPayment', 0, totalPayment, '₹');
                    animateCountUp('#totalInterest', 0, totalInterest, '₹');

                    // Add pulse animation to results
                    $('.result-item').addClass('pulse-animation');
                    setTimeout(() => {
                        $('.result-item').removeClass('pulse-animation');
                    }, 2000);

                    // Generate full amortization schedule
                    generateFullAmortizationSchedule(loanAmount, monthlyPayment, monthlyRate, numPayments);
                    
                    // Create bar chart
                    createBarChart(loanAmount, totalInterest, monthlyPayment, numPayments);
                    
                    // Show sections with animation
                    setTimeout(() => {
                        $('#chartSection').removeClass('d-none').addClass('bounce-in');
                    }, 500);
                    
                    setTimeout(() => {
                        $('#tableSection').removeClass('d-none').addClass('bounce-in');
                    }, 1000);
                    
                }, 1500);
            }

            function animateCountUp(selector, start, end, prefix = '') {
                const element = $(selector);
                const increment = (end - start) / 50;
                let current = start;
                
                const timer = setInterval(() => {
                    current += increment;
                    if (current >= end) {
                        current = end;
                        clearInterval(timer);
                    }
                    element.text(prefix + current.toFixed(2));
                }, 30);
            }

            function generateFullAmortizationSchedule(principal, monthlyPayment, monthlyRate, numPayments) {
                loanData = [];
                let remainingBalance = principal;

                for (let i = 1; i <= numPayments; i++) {
                    const interestPayment = remainingBalance * monthlyRate;
                    const principalPayment = monthlyPayment - interestPayment;
                    remainingBalance -= principalPayment;

                    const payment = {
                        paymentNumber: i,
                        paymentAmount: monthlyPayment,
                        principal: principalPayment,
                        interest: interestPayment,
                        remainingBalance: remainingBalance < 0 ? 0 : remainingBalance
                    };

                    loanData.push(payment);
                }

                // Populate DataTable
                populateDataTable();
            }

            function populateDataTable() {
                const tableBody = $('#tableBody');
                tableBody.empty();

                loanData.forEach(payment => {
                    const row = $(`
                        <tr>
                            <td>${payment.paymentNumber}</td>
                            <td>₹${payment.paymentAmount.toFixed(2)}</td>
                            <td>₹${payment.principal.toFixed(2)}</td>
                            <td>₹${payment.interest.toFixed(2)}</td>
                            <td>₹${payment.remainingBalance.toFixed(2)}</td>
                        </tr>
                    `);
                    tableBody.append(row);
                });

                // Initialize DataTable with enhanced features
                if (dataTable) {
                    dataTable.destroy();
                }
                
                dataTable = $('#amortizationTable').DataTable({
                    pageLength: 25,
                    lengthMenu: [[25, 50, 100, -1], [25, 50, 100, "All"]],
                    responsive: true,
                    order: [[0, 'asc']],
                    language: {
                        search: "Search payments:",
                        lengthMenu: "Show _MENU_ payments per page",
                        info: "Showing _START_ to _END_ of _TOTAL_ payments",
                        infoEmpty: "No payments found",
                        paginate: {
                            first: "First",
                            last: "Last",
                            next: "Next",
                            previous: "Previous"
                        }
                    },
                    dom: 'Bfrtip',
                    scrollX: true
                });
            }

            function createBarChart(principal, totalInterest, monthlyPayment, numPayments) {
                const ctx = $('#loanChart')[0].getContext('2d');
                
                if (chart) {
                    chart.destroy();
                }

                // Create data for monthly breakdown
                const monthlyData = [];
                const monthlyLabels = [];
                
                // Show first 12 months or all payments if less than 12
                const displayMonths = Math.min(numPayments, 12);
                
                for (let month = 1; month <= displayMonths; month++) {
                    if (loanData[month - 1]) {
                        monthlyLabels.push(`Month ${month}`);
                        monthlyData.push({
                            principal: loanData[month - 1].principal,
                            interest: loanData[month - 1].interest
                        });
                    }
                }

                chart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: monthlyLabels,
                        datasets: [
                            {
                                label: 'Principal Payment',
                                data: monthlyData.map(d => d.principal),
                                backgroundColor: 'rgba(255, 255, 255, 0.8)',
                                borderColor: 'rgba(255, 255, 255, 1)',
                                borderWidth: 2,
                                borderRadius: 8,
                                borderSkipped: false
                            },
                            {
                                label: 'Interest Payment',
                                data: monthlyData.map(d => d.interest),
                                backgroundColor: 'rgba(128, 128, 128, 0.8)',
                                borderColor: 'rgba(128, 128, 128, 1)',
                                borderWidth: 2,
                                borderRadius: 8,
                                borderSkipped: false
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    color: '#ffffff',
                                    font: {
                                        size: 14,
                                        weight: 'bold'
                                    },
                                    padding: 20,
                                    usePointStyle: true
                                }
                            },
                            title: {
                                display: true,
                                text: 'Monthly Payment Breakdown (First 12 Months)',
                                color: '#ffffff',
                                font: {
                                    size: 18,
                                    weight: 'bold'
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: '#ffffff',
                                bodyColor: '#ffffff',
                                borderColor: 'rgba(255, 255, 255, 0.3)',
                                borderWidth: 1,
                                callbacks: {
                                    label: function(context) {
                                        return context.dataset.label + ': ₹' + context.raw.toFixed(2);
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                stacked: true,
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)',
                                    lineWidth: 1
                                },
                                ticks: {
                                    color: '#ffffff',
                                    font: {
                                        size: 12,
                                        weight: 'bold'
                                    }
                                }
                            },
                            y: {
                                stacked: true,
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)',
                                    lineWidth: 1
                                },
                                ticks: {
                                    color: '#ffffff',
                                    font: {
                                        size: 12,
                                        weight: 'bold'
                                    },
                                    callback: function(value) {
                                        return '₹' + value.toFixed(0);
                                    }
                                }
                            }
                        },
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        },
                        animation: {
                            duration: 2000,
                            easing: 'easeOutBounce'
                        },
                        elements: {
                            bar: {
                                borderRadius: 8
                            }
                        }
                    }
                });
            }

            // Download Functions
            $('#downloadCSV').click(function() {
                downloadCSV();
            });

            $('#downloadPDF').click(function() {
                downloadPDF();
            });

            $('#printTable').click(function() {
                printTable();
            });

            function downloadCSV() {
                let csvContent = "data:text/csv;charset=utf-8,";
                csvContent += "Payment Number,Payment Amount,Principal,Interest,Remaining Balance\n";
                
                loanData.forEach(payment => {
                    csvContent += `${payment.paymentNumber},${payment.paymentAmount.toFixed(2)},${payment.principal.toFixed(2)},${payment.interest.toFixed(2)},${payment.remainingBalance.toFixed(2)}\n`;
                });

                const encodedUri = encodeURI(csvContent);
                const link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", `loan_amortization_schedule_${new Date().toISOString().split('T')[0]}.csv`);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                // Show success message
                showToast('CSV downloaded successfully!', 'success');
            }

            function downloadPDF() {
                // Create a new window for printing
                const printWindow = window.open('', '_blank');
                const loanAmount = $('#loanAmount').val();
                const interestRate = $('#interestRate').val();
                const loanTerm = $('#loanTerm').val();
                const monthlyPayment = $('#monthlyPayment').text();
                const totalPayment = $('#totalPayment').text();
                const totalInterest = $('#totalInterest').text();

                let tableRows = '';
                loanData.forEach(payment => {
                    tableRows += `
                        <tr>
                            <td>${payment.paymentNumber}</td>
                            <td>₹${payment.paymentAmount.toFixed(2)}</td>
                            <td>₹${payment.principal.toFixed(2)}</td>
                            <td>₹${payment.interest.toFixed(2)}</td>
                            <td>₹${payment.remainingBalance.toFixed(2)}</td>
                        </tr>
                    `;
                });

                printWindow.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>Loan Amortization Schedule</title>
                        <style>
                            body { 
                                font-family: Arial, sans-serif; 
                                margin: 20px;
                                color: #333;
                            }
                            .header {
                                text-align: center;
                                margin-bottom: 30px;
                                border-bottom: 2px solid #333;
                                padding-bottom: 20px;
                            }
                            .summary {
                                display: grid;
                                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                                gap: 20px;
                                margin-bottom: 30px;
                                background: #f5f5f5;
                                padding: 20px;
                                border-radius: 10px;
                            }
                            .summary-item {
                                text-align: center;
                            }
                            .summary-label {
                                font-weight: bold;
                                color: #666;
                                margin-bottom: 5px;
                            }
                            .summary-value {
                                font-size: 18px;
                                font-weight: bold;
                                color: #333;
                            }
                            table { 
                                width: 100%; 
                                border-collapse: collapse;
                                margin-top: 20px;
                            }
                            th, td { 
                                padding: 10px; 
                                border: 1px solid #ddd; 
                                text-align: center;
                                font-size: 12px;
                            }
                            th { 
                                background-color: #333; 
                                color: white;
                                font-weight: bold;
                            }
                            tr:nth-child(even) {
                                background-color: #f9f9f9;
                            }
                            .footer {
                                margin-top: 30px;
                                text-align: center;
                                font-size: 12px;
                                color: #666;
                            }
                            @media print {
                                body { margin: 10px; }
                                .header { page-break-after: avoid; }
                            }
                        </style>
                    </head>
                    <body>
                        <div class="header">
                            <h1>Loan Amortization Schedule</h1>
                            <p>Generated on ${new Date().toLocaleDateString()}</p>
                        </div>
                        
                        <div class="summary">
                            <div class="summary-item">
                                <div class="summary-label">Loan Amount</div>
                                <div class="summary-value">₹${parseFloat(loanAmount).toFixed(2)}</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-label">Interest Rate</div>
                                <div class="summary-value">${interestRate}%</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-label">Loan Term</div>
                                <div class="summary-value">${loanTerm} years</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-label">Monthly Payment</div>
                                <div class="summary-value">${monthlyPayment}</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-label">Total Payment</div>
                                <div class="summary-value">${totalPayment}</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-label">Total Interest</div>
                                <div class="summary-value">${totalInterest}</div>
                            </div>
                        </div>

                        <table>
                            <thead>
                                <tr>
                                    <th>Payment #</th>
                                    <th>Payment Amount</th>
                                    <th>Principal</th>
                                    <th>Interest</th>
                                    <th>Remaining Balance</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${tableRows}
                            </tbody>
                        </table>
                        
                        <div class="footer">
                            <p>This amortization schedule is for informational purposes only.</p>
                        </div>
                    </body>
                    </html>
                `);
                
                printWindow.document.close();
                setTimeout(() => {
                    printWindow.print();
                    showToast('PDF generation started!', 'info');
                }, 1000);
            }

            function printTable() {
                window.print();
                showToast('Print dialog opened!', 'info');
            }

            function showToast(message, type = 'success') {
                const toastHtml = `
                    <div class="toast align-items-center text-white bg-${type === 'success' ? 'success' : type === 'error' ? 'danger' : 'info'} border-0" role="alert" aria-live="assertive" aria-atomic="true">
                        <div class="d-flex">
                            <div class="toast-body">
                                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'} me-2"></i>
                                ${message}
                            </div>
                            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                        </div>
                    </div>
                `;
                
                let toastContainer = $('#toastContainer');
                if (toastContainer.length === 0) {
                    $('body').append('<div id="toastContainer" class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1051;"></div>');
                    toastContainer = $('#toastContainer');
                }
                
                toastContainer.append(toastHtml);
                const toast = new bootstrap.Toast(toastContainer.find('.toast').last()[0]);
                toast.show();
            }

            // Enhanced form interactions
            $('.form-control').on('focus', function() {
                $(this).parent().addClass('animate__animated animate__pulse');
            }).on('blur', function() {
                $(this).parent().removeClass('animate__animated animate__pulse');
            });

            // Smooth scroll to results when calculation is complete
            function scrollToResults() {
                $('html, body').animate({
                    scrollTop: $('#chartSection').offset().top - 100
                }, 1000);
            }

            // Add keyboard shortcuts
            $(document).keydown(function(e) {
                // Ctrl/Cmd + Enter to calculate
                if ((e.ctrlKey || e.metaKey) && e.keyCode === 13) {
                    $('#calculateBtn').click();
                }
                // Escape to clear form
                if (e.keyCode === 27) {
                    if (confirm('Clear all form data?')) {
                        $('#loanForm')[0].reset();
                        $('.form-control').removeClass('is-valid is-invalid');
                        $('#chartSection, #tableSection').addClass('d-none');
                    }
                }
            });

            // Add tooltips to buttons
            $('[data-bs-toggle="tooltip"]').tooltip();

            // Add floating particles effect
            function createFloatingParticles() {
                for (let i = 0; i < 20; i++) {
                    const particle = $('<div class="floating-particle"></div>');
                    particle.css({
                        position: 'fixed',
                        width: Math.random() * 4 + 2 + 'px',
                        height: Math.random() * 4 + 2 + 'px',
                        background: 'rgba(255, 255, 255, 0.1)',
                        borderRadius: '50%',
                        left: Math.random() * 100 + 'vw',
                        top: Math.random() * 100 + 'vh',
                        pointerEvents: 'none',
                        zIndex: -1
                    });
                    
                    $('body').append(particle);
                    
                    particle.animate({
                        top: '-10px',
                        opacity: 0
                    }, {
                        duration: Math.random() * 3000 + 2000,
                        easing: 'linear',
                        complete: function() {
                            $(this).remove();
                        }
                    });
                }
            }

            // Create particles periodically
            setInterval(createFloatingParticles, 2000);

            // Initialize tooltips for better UX
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.map(function(tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
        });
    </script>
</body>
</html>
