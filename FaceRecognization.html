<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Face Detection & Capture - 2060 Edition</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="icon" href="https://blogger.googleusercontent.com/img/a/AVvXsEgIFnXbCEgaASrlgiFnXz6MPaK-kyelPH7eTOt9s0-nWtY5YSMAIG5mN4k7dnxX6M-C0AmbO3U9jikPwhBdpp7G9848hK_1c7kXLbqxamlfCbhe_l-kEb8pe5V6mEH3fiIokyxkIyavBLAMlAzSApPTbcYA1r-P9YDwpu9GBIsL1SV4zGLvMwFulKOECQ4" type="image/x-icon">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.11.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/face-landmarks-detection@0.0.3/dist/face-landmarks-detection.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap');
        
        :root {
            --primary-color: #00ffff;
            --secondary-color: #ff00ff;
            --accent-color: #ffff00;
            --dark-bg: #050505;
            --darker-bg: #020202;
            --light-text: #f0f0f0;
            --card-bg: rgba(0, 20, 40, 0.3);
            --border-color: rgba(0, 255, 255, 0.3);
            --glow-color: #00ffff;
            --danger-glow: #ff0080;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Rajdhani', sans-serif;
            background: linear-gradient(135deg, #050505 0%, #0a0a1a 50%, #050515 100%);
            color: var(--light-text);
            height: 100vh;
            overflow: hidden;
            position: relative;
        }
        
        /* Animated background particles */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
        }
        
        .particle {
            position: absolute;
            display: block;
            pointer-events: none;
            opacity: 0;
        }
        
        .particle::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(0, 255, 255, 0.8) 0%, rgba(0, 255, 255, 0) 70%);
            border-radius: 50%;
        }
        
        /* Holographic grid background */
        .grid-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(0, 255, 255, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 255, 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            z-index: -2;
            animation: grid-move 20s linear infinite;
        }
        
        @keyframes grid-move {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }
        
        /* Main container */
        .main-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            padding: 20px;
            position: relative;
            z-index: 1;
        }
        
        /* Header */
        .header {
            margin-bottom: 30px;
            text-align: center;
            position: relative;
        }
        
        h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 3.5rem;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 3px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color), var(--accent-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
            margin-bottom: 10px;
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { filter: drop-shadow(0 0 10px rgba(0, 255, 255, 0.7)); }
            to { filter: drop-shadow(0 0 20px rgba(255, 0, 255, 0.7)); }
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.7);
            letter-spacing: 2px;
        }
        
        /* Video container */
        .video-container {
            position: relative;
            width: 100%;
            max-width: 700px;
            margin-bottom: 30px;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 
                0 0 30px rgba(0, 255, 255, 0.5),
                inset 0 0 30px rgba(0, 255, 255, 0.1);
            background: rgba(0, 20, 40, 0.2);
            padding: 5px;
        }
        
        .video-frame {
            position: relative;
            width: 100%;
            padding-bottom: 75%;
            border-radius: 15px;
            overflow: hidden;
            background: #000;
        }
        
        #video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 15px;
        }
        
        /* Scanning effect */
        .scan-line {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--primary-color), transparent);
            animation: scan 3s linear infinite;
            z-index: 2;
        }
        
        @keyframes scan {
            0% { top: 0; }
            100% { top: 100%; }
        }
        
        /* Face detection overlay */
        .face-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 3;
        }
        
        .face-box {
            position: absolute;
            border: 2px solid var(--primary-color);
            box-shadow: 0 0 10px var(--primary-color);
            border-radius: 5px;
            display: none;
        }
        
        .face-box::before {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            width: 10px;
            height: 10px;
            border-top: 2px solid var(--primary-color);
            border-left: 2px solid var(--primary-color);
        }
        
        .face-box::after {
            content: '';
            position: absolute;
            bottom: -5px;
            right: -5px;
            width: 10px;
            height: 10px;
            border-bottom: 2px solid var(--primary-color);
            border-right: 2px solid var(--primary-color);
        }
        
        .face-info {
            position: absolute;
            top: -30px;
            left: 0;
            background: rgba(0, 0, 0, 0.7);
            color: var(--primary-color);
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 12px;
            white-space: nowrap;
        }
        
        /* Control panel */
        .control-panel {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            width: 100%;
            max-width: 700px;
        }
        
        .control-btn {
            position: relative;
            padding: 15px 30px;
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.1), rgba(255, 0, 255, 0.1));
            border: 1px solid var(--border-color);
            border-radius: 50px;
            color: var(--light-text);
            font-family: 'Orbitron', sans-serif;
            font-weight: 600;
            font-size: 1rem;
            letter-spacing: 1px;
            cursor: pointer;
            overflow: hidden;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }
        
        .control-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .control-btn:hover::before {
            left: 100%;
        }
        
        .control-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 255, 255, 0.3);
        }
        
        .control-btn:active {
            transform: translateY(-2px);
        }
        
        .control-btn.capture {
            background: linear-gradient(135deg, rgba(0, 255, 0, 0.2), rgba(0, 255, 0, 0.1));
            border-color: rgba(0, 255, 0, 0.5);
        }
        
        .control-btn.record {
            background: linear-gradient(135deg, rgba(255, 0, 0, 0.2), rgba(255, 0, 0, 0.1));
            border-color: rgba(255, 0, 0, 0.5);
        }
        
        .control-btn.recording {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 0, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0); }
        }
        
        /* Status panel */
        .status-panel {
            width: 100%;
            max-width: 700px;
            background: rgba(0, 20, 40, 0.2);
            border: 1px solid var(--border-color);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .status-label {
            color: rgba(255, 255, 255, 0.7);
        }
        
        .status-value {
            color: var(--primary-color);
            font-weight: 600;
        }
        
        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background: rgba(0, 20, 40, 0.8);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            color: var(--light-text);
            font-weight: 600;
            transform: translateX(120%);
            transition: transform 0.3s ease;
            z-index: 1000;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            border-color: rgba(0, 255, 0, 0.5);
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.3);
        }
        
        .notification.error {
            border-color: rgba(255, 0, 0, 0.5);
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.3);
        }
        
        /* Home button */
        .home-button {
            position: fixed;
            top: 20px;
            left: 20px;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 20, 40, 0.5);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            transition: all 0.3s ease;
            cursor: pointer;
            z-index: 100;
        }
        
        .home-button:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        }
        
        .home-button svg {
            width: 30px;
            height: 30px;
            fill: var(--primary-color);
        }
        
        /* Settings panel */
        .settings-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 20, 40, 0.5);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            transition: all 0.3s ease;
            cursor: pointer;
            z-index: 100;
        }
        
        .settings-panel:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        }
        
        .settings-panel svg {
            width: 30px;
            height: 30px;
            fill: var(--primary-color);
        }
        
        .settings-dropdown {
            position: absolute;
            top: 70px;
            right: 0;
            width: 250px;
            background: rgba(0, 20, 40, 0.9);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 15px;
            display: none;
            z-index: 101;
        }
        
        .settings-dropdown.show {
            display: block;
        }
        
        .setting-item {
            margin-bottom: 15px;
        }
        
        .setting-label {
            display: block;
            margin-bottom: 5px;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .setting-control {
            width: 100%;
            padding: 8px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-color);
            border-radius: 5px;
            color: var(--light-text);
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.2);
            transition: .4s;
            border-radius: 24px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: var(--primary-color);
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        /* Canvas for image processing */
        #canvas {
            display: none;
        }
        
        /* Loading indicator */
        .loading-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: none;
        }
        
        .loading-indicator.show {
            display: block;
        }
        
        .loading-ring {
            display: inline-block;
            width: 80px;
            height: 80px;
        }
        
        .loading-ring:after {
            content: " ";
            display: block;
            width: 64px;
            height: 64px;
            margin: 8px;
            border-radius: 50%;
            border: 6px solid var(--border-color);
            border-color: var(--primary-color) transparent var(--primary-color) transparent;
            animation: loading-ring 1.2s linear infinite;
        }
        
        @keyframes loading-ring {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Voice control indicator */
        .voice-control {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 20, 40, 0.5);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            transition: all 0.3s ease;
            cursor: pointer;
            z-index: 100;
        }
        
        .voice-control:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        }
        
        .voice-control.active {
            animation: pulse 1.5s infinite;
            background: rgba(255, 0, 0, 0.2);
            border-color: rgba(255, 0, 0, 0.5);
        }
        
        .voice-control svg {
            width: 30px;
            height: 30px;
            fill: var(--primary-color);
        }
        
        .voice-control.active svg {
            fill: var(--danger-glow);
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            h1 {
                font-size: 2.5rem;
            }
            
            .control-panel {
                gap: 10px;
            }
            
            .control-btn {
                padding: 12px 20px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <!-- Animated background particles -->
    <div class="particles" id="particles"></div>
    
    <!-- Holographic grid background -->
    <div class="grid-bg"></div>
    
    <!-- Home button -->
    <div class="home-button" onclick="window.location.href='index.html'" title="Back to Home">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
        </svg>
    </div>
    
    <!-- Settings panel -->
    <div class="settings-panel" id="settingsBtn">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
        </svg>
        <div class="settings-dropdown" id="settingsDropdown">
            <div class="setting-item">
                <label class="setting-label">Face Detection Sensitivity</label>
                <input type="range" class="setting-control" id="sensitivity" min="1" max="10" value="5">
            </div>
            <div class="setting-item">
                <label class="setting-label">Auto Capture</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="autoCapture">
                    <span class="slider"></span>
                </label>
            </div>
            <div class="setting-item">
                <label class="setting-label">Enhanced Filters</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="enhancedFilters" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <div class="setting-item">
                <label class="setting-label">Voice Control</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="voiceControl">
                    <span class="slider"></span>
                </label>
            </div>
        </div>
    </div>
    
    <!-- Voice control indicator -->
    <div class="voice-control" id="voiceControlBtn" title="Voice Control">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
            <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
        </svg>
    </div>
    
    <!-- Main container -->
    <div class="main-container">
        <div class="header">
            <h1>Face Detection & Capture</h1>
            <p class="subtitle">Neural Interface v2.0 - 2060 Edition</p>
        </div>
        
        <div class="video-container">
            <div class="video-frame">
                <video id="video" autoplay></video>
                <div class="scan-line"></div>
                <div class="face-overlay" id="faceOverlay">
                    <div class="face-box" id="faceBox">
                        <div class="face-info" id="faceInfo">Face Detected</div>
                    </div>
                </div>
                <div class="loading-indicator" id="loadingIndicator">
                    <div class="loading-ring"></div>
                </div>
            </div>
        </div>
        
        <div class="control-panel">
            <button id="capture" class="control-btn capture">Capture Image</button>
            <button id="startRecord" class="control-btn record">Start Recording</button>
            <button id="stopRecord" class="control-btn record hidden">Stop Recording</button>
            <button id="enhance" class="control-btn">Enhance</button>
            <button id="analyze" class="control-btn">Analyze</button>
        </div>
        
        <div class="status-panel">
            <div class="status-item">
                <span class="status-label">System Status:</span>
                <span class="status-value" id="systemStatus">Online</span>
            </div>
            <div class="status-item">
                <span class="status-label">Face Detection:</span>
                <span class="status-value" id="detectionStatus">Scanning...</span>
            </div>
            <div class="status-item">
                <span class="status-label">Camera Resolution:</span>
                <span class="status-value" id="resolution">Detecting...</span>
            </div>
            <div class="status-item">
                <span class="status-label">Processing Mode:</span>
                <span class="status-value" id="processingMode">Standard</span>
            </div>
        </div>
    </div>
    
    <!-- Notification -->
    <div class="notification" id="notification"></div>
    
    <!-- Canvas for image processing -->
    <canvas id="canvas"></canvas>
    
    <script>
        $(document).ready(function(){
            let video = document.getElementById("video");
            let canvas = document.getElementById("canvas");
            let context = canvas.getContext("2d");
            let mediaRecorder;
            let recordedChunks = [];
            let model;
            let faceDetectionInterval;
            let isVoiceControlActive = false;
            let recognition;
            
            // Initialize particles
            function createParticles() {
                const particlesContainer = document.getElementById('particles');
                const particleCount = 50;
                
                for (let i = 0; i < particleCount; i++) {
                    const particle = document.createElement('div');
                    particle.classList.add('particle');
                    
                    // Random size
                    const size = Math.random() * 5 + 1;
                    particle.style.width = `${size}px`;
                    particle.style.height = `${size}px`;
                    
                    // Random position
                    const posX = Math.random() * window.innerWidth;
                    const posY = Math.random() * window.innerHeight;
                    particle.style.left = `${posX}px`;
                    particle.style.top = `${posY}px`;
                    
                    // Random animation duration and delay
                    const duration = Math.random() * 20 + 10;
                    const delay = Math.random() * 5;
                    particle.style.animation = `float ${duration}s ${delay}s infinite ease-in-out`;
                    
                    particlesContainer.appendChild(particle);
                }
            }
            
            // Add floating animation for particles
            const style = document.createElement('style');
            style.textContent = `
                @keyframes float {
                    0% { transform: translateY(0) translateX(0); opacity: 0; }
                    10% { opacity: 1; }
                    90% { opacity: 1; }
                    100% { transform: translateY(-100vh) translateX(100px); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
            
            createParticles();
            
            // Initialize face detection model
            async function initializeModel() {
                $('#loadingIndicator').addClass('show');
                $('#systemStatus').text('Loading AI Model...');
                
                try {
                    model = await faceLandmarksDetection.load(
                        faceLandmarksDetection.SupportedPackages.mediapipeFacemesh,
                        { maxFaces: 1 }
                    );
                    
                    $('#loadingIndicator').removeClass('show');
                    $('#systemStatus').text('Online');
                    showNotification('AI Model Loaded Successfully', 'success');
                    
                    // Start face detection
                    startFaceDetection();
                } catch (error) {
                    console.error('Failed to load model:', error);
                    $('#loadingIndicator').removeClass('show');
                    $('#systemStatus').text('Limited Mode');
                    showNotification('Failed to load AI model. Using basic detection.', 'error');
                }
            }
            
            // Start face detection
            function startFaceDetection() {
                if (!model) return;
                
                faceDetectionInterval = setInterval(async () => {
                    try {
                        const predictions = await model.estimateFaces({
                            input: video,
                            returnTensors: false,
                            flipHorizontal: false
                        });
                        
                        if (predictions.length > 0) {
                            // Face detected
                            $('#detectionStatus').text('Face Detected');
                            $('#faceBox').css('display', 'block');
                            
                            // Get face bounding box
                            const face = predictions[0];
                            const boundingBox = face.boundingBox;
                            const topLeft = boundingBox.topLeft;
                            const bottomRight = boundingBox.bottomRight;
                            
                            // Position the face box
                            const videoWidth = video.videoWidth;
                            const videoHeight = video.videoHeight;
                            const videoElementWidth = video.offsetWidth;
                            const videoElementHeight = video.offsetHeight;
                            
                            const scaleX = videoElementWidth / videoWidth;
                            const scaleY = videoElementHeight / videoHeight;
                            
                            const boxWidth = (bottomRight[0] - topLeft[0]) * scaleX;
                            const boxHeight = (bottomRight[1] - topLeft[1]) * scaleY;
                            const boxLeft = topLeft[0] * scaleX;
                            const boxTop = topLeft[1] * scaleY;
                            
                            $('#faceBox').css({
                                left: `${boxLeft}px`,
                                top: `${boxTop}px`,
                                width: `${boxWidth}px`,
                                height: `${boxHeight}px`
                            });
                            
                            // Update face info
                            const confidence = Math.round(face.faceInViewConfidence * 100);
                            $('#faceInfo').text(`Face: ${confidence}%`);
                            
                            // Auto capture if enabled
                            if ($('#autoCapture').is(':checked') && confidence > 80) {
                                setTimeout(() => {
                                    if ($('#autoCapture').is(':checked')) {
                                        captureImage();
                                    }
                                }, 1000);
                            }
                        } else {
                            // No face detected
                            $('#detectionStatus').text('Scanning...');
                            $('#faceBox').css('display', 'none');
                        }
                    } catch (error) {
                        console.error('Face detection error:', error);
                    }
                }, 100);
            }
            
            // Initialize camera
            navigator.mediaDevices.getUserMedia({ 
                video: { 
                    width: { ideal: 1280 },
                    height: { ideal: 720 }
                } 
            })
            .then(stream => { 
                video.srcObject = stream;
                
                // Get video resolution
                video.addEventListener('loadedmetadata', () => {
                    const width = video.videoWidth;
                    const height = video.videoHeight;
                    $('#resolution').text(`${width}x${height}`);
                    
                    // Set canvas dimensions
                    canvas.width = width;
                    canvas.height = height;
                });
                
                // Initialize media recorder
                mediaRecorder = new MediaRecorder(stream);
                
                mediaRecorder.ondataavailable = event => {
                    if (event.data.size > 0) {
                        recordedChunks.push(event.data);
                    }
                };
                
                mediaRecorder.onstop = () => {
                    const blob = new Blob(recordedChunks, { type: "video/webm" });
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement("a");
                    link.href = url;
                    link.download = `recording_${new Date().getTime()}.webm`;
                    link.click();
                    
                    recordedChunks = [];
                    showNotification('Video saved successfully', 'success');
                };
                
                // Initialize AI model
                initializeModel();
            })
            .catch(err => { 
                console.error('Camera access error:', err);
                showNotification('Camera access denied!', 'error');
                $('#systemStatus').text('Offline');
            });
            
            // Capture image
            function captureImage() {
                context.drawImage(video, 0, 0, canvas.width, canvas.height);
                
                // Apply enhanced filters if enabled
                if ($('#enhancedFilters').is(':checked')) {
                    applyEnhancedFilters();
                }
                
                // Create download link
                const link = document.createElement('a');
                link.href = canvas.toDataURL('image/png');
                link.download = `capture_${new Date().getTime()}.png`;
                link.click();
                
                showNotification('Image captured successfully', 'success');
            }
            
            // Apply enhanced filters
            function applyEnhancedFilters() {
                const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
                const data = imageData.data;
                
                // Apply cyberpunk-style filter
                for (let i = 0; i < data.length; i += 4) {
                    // Enhance cyan and magenta tones
                    const r = data[i];
                    const g = data[i + 1];
                    const b = data[i + 2];
                    
                    // Shift colors towards cyan/magenta
                    data[i] = r * 0.8;     // Red
                    data[i + 1] = g * 1.2; // Green
                    data[i + 2] = b * 1.3; // Blue
                }
                
                context.putImageData(imageData, 0, 0);
            }
            
            // Show notification
            function showNotification(message, type) {
                const notification = $('#notification');
                notification.text(message);
                notification.removeClass('success error').addClass(type);
                notification.addClass('show');
                
                setTimeout(() => {
                    notification.removeClass('show');
                }, 3000);
            }
            
            // Button event handlers
            $("#capture").click(function(){
                captureImage();
            });
            
            $("#startRecord").click(function(){
                recordedChunks = [];
                mediaRecorder.start();
                $("#startRecord").addClass("hidden recording");
                $("#stopRecord").removeClass("hidden");
                showNotification('Recording started', 'success');
            });
            
            $("#stopRecord").click(function(){
                mediaRecorder.stop();
                $("#stopRecord").addClass("hidden");
                $("#startRecord").removeClass("hidden recording");
            });
            
            $("#enhance").click(function(){
                $('#processingMode').text('Enhancement');
                $('#loadingIndicator').addClass('show');
                
                setTimeout(() => {
                    context.drawImage(video, 0, 0, canvas.width, canvas.height);
                    applyEnhancedFilters();
                    
                    // Create download link
                    const link = document.createElement('a');
                    link.href = canvas.toDataURL('image/png');
                    link.download = `enhanced_${new Date().getTime()}.png`;
                    link.click();
                    
                    $('#loadingIndicator').removeClass('show');
                    $('#processingMode').text('Standard');
                    showNotification('Image enhanced and saved', 'success');
                }, 1500);
            });
            
            $("#analyze").click(function(){
                $('#processingMode').text('Analysis');
                $('#loadingIndicator').addClass('show');
                
                setTimeout(() => {
                    // Simulate analysis
                    const analysisResults = [
                        'Face Match: 98.7%',
                        'Emotion: Neutral',
                        'Age Estimate: 25-30',
                        'Attention Level: High'
                    ];
                    
                    $('#loadingIndicator').removeClass('show');
                    $('#processingMode').text('Standard');
                    
                    // Display results
                    let resultText = 'Analysis Results:\n';
                    analysisResults.forEach(result => {
                        resultText += `${result}\n`;
                    });
                    
                    showNotification('Analysis complete', 'success');
                    alert(resultText);
                }, 2000);
            });
            
            // Settings panel
            $('#settingsBtn').click(function(e) {
                e.stopPropagation();
                $('#settingsDropdown').toggleClass('show');
            });
            
            $(document).click(function() {
                $('#settingsDropdown').removeClass('show');
            });
            
            $('#settingsDropdown').click(function(e) {
                e.stopPropagation();
            });
            
            // Voice control
            function initializeVoiceControl() {
                if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                    showNotification('Voice control not supported in this browser', 'error');
                    return;
                }
                
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.continuous = true;
                recognition.interimResults = false;
                recognition.lang = 'en-US';
                
                recognition.onresult = function(event) {
                    const command = event.results[event.results.length - 1][0].transcript.toLowerCase();
                    
                    if (command.includes('capture') || command.includes('take picture')) {
                        captureImage();
                    } else if (command.includes('start recording')) {
                        if ($('#startRecord').is(':visible')) {
                            $('#startRecord').click();
                        }
                    } else if (command.includes('stop recording')) {
                        if ($('#stopRecord').is(':visible')) {
                            $('#stopRecord').click();
                        }
                    } else if (command.includes('enhance')) {
                        $('#enhance').click();
                    } else if (command.includes('analyze')) {
                        $('#analyze').click();
                    }
                    
                    showNotification(`Command recognized: "${command}"`, 'success');
                };
                
                recognition.onerror = function(event) {
                    console.error('Speech recognition error:', event.error);
                    if (event.error === 'no-speech') {
                        // Continue listening
                        recognition.start();
                    }
                };
                
                recognition.onend = function() {
                    if (isVoiceControlActive) {
                        // Restart recognition if it's still active
                        recognition.start();
                    }
                };
            }
            
            $('#voiceControl').change(function() {
                if ($(this).is(':checked')) {
                    if (!recognition) {
                        initializeVoiceControl();
                    }
                    
                    isVoiceControlActive = true;
                    $('#voiceControlBtn').addClass('active');
                    recognition.start();
                    showNotification('Voice control activated', 'success');
                } else {
                    isVoiceControlActive = false;
                    $('#voiceControlBtn').removeClass('active');
                    if (recognition) {
                        recognition.stop();
                    }
                    showNotification('Voice control deactivated', 'success');
                }
            });
            
            $('#voiceControlBtn').click(function() {
                $('#voiceControl').prop('checked', !$('#voiceControl').prop('checked')).trigger('change');
            });
        });
    </script>
</body>
</html>
